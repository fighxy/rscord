# RSCORD - Comprehensive Project Documentation

## 📋 Обзор проекта

**RSCORD** - это современное Discord-подобное приложение для общения и управления сообществами, построенное на основе современных технологий и архитектурных паттернов. Проект представляет собой полнофункциональную платформу для создания серверов, управления ролями, общения в реальном времени и совместной работы.

### 🎯 Основные цели проекта

- Создание альтернативы Discord с открытым исходным кодом
- Демонстрация современных архитектурных решений
- Реализация real-time коммуникации
- Построение масштабируемой системы управления сообществами

## 🏗️ Архитектура системы

### Общая архитектура

RSCORD построен по принципу **микросервисной архитектуры** с четким разделением ответственности:

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Desktop App   │    │   API Server    │    │   Event Server  │
│   (Tauri +      │◄──►│   (Rust +       │◄──►│   (WebSocket +  │
│    React)       │    │    Axum)        │    │   Real-time)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   WebRTC        │    │   MongoDB       │    │   Redis         │
│   (Voice Chat)  │    │   (Data Store)  │    │   (Cache)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### Технологический стек

#### Frontend (Desktop App)
- **Tauri 2.0** - фреймворк для создания кроссплатформенных десктопных приложений
- **React 19** - современная библиотека для построения пользовательских интерфейсов
- **TypeScript** - типизированный JavaScript для надежности кода
- **Vite** - быстрый инструмент сборки
- **Zustand** - легковесное управление состоянием
- **React Query** - управление серверным состоянием и кешированием

#### Backend (Servers)
- **Rust** - системный язык программирования для высокой производительности
- **Axum** - современный веб-фреймворк для Rust
- **MongoDB** - NoSQL база данных для гибкого хранения данных
- **Redis** - in-memory хранилище для кеширования и сессий
- **RabbitMQ** - message broker для асинхронной обработки
- **WebSocket** - протокол для real-time коммуникации

#### Инфраструктура
- **Docker Compose** - оркестрация микросервисов
- **MinIO** - S3-совместимое хранилище файлов
- **JWT** - безопасная аутентификация

## 🏛️ Структура проекта

### Корневая структура

```
rscord/
├── apps/                    # Клиентские приложения
│   └── desktop/            # Десктопное приложение
├── servers/                 # Серверная часть
│   ├── crates/             # Rust микросервисы
│   └── signaling/          # WebRTC signaling сервер
├── scripts/                 # Скрипты для запуска
├── docker-compose.yml       # Конфигурация Docker
└── README.md               # Основная документация
```

### Клиентская архитектура (Desktop App)

#### Модульная структура

```
src/
├── app/                    # Основные провайдеры и роутинг
│   ├── AppProviders.tsx   # Провайдеры контекста
│   └── routes.tsx         # Конфигурация маршрутов
├── modules/                # Функциональные модули
│   ├── auth/              # Аутентификация и авторизация
│   ├── layout/            # Компоненты макета
│   ├── guilds/            # Управление серверами
│   ├── channels/          # Управление каналами
│   ├── chat/              # Система чата
│   ├── roles/             # Управление ролями
│   ├── events/            # Real-time события
│   ├── voice/             # Голосовая связь
│   ├── notifications/     # Система уведомлений
│   ├── search/            # Поиск по контенту
│   ├── settings/          # Настройки пользователя
│   ├── attachments/       # Управление файлами
│   └── reactions/         # Реакции на сообщения
├── shared/                 # Общие утилиты и компоненты
├── styles/                 # Глобальные стили
└── webrtc/                # WebRTC интеграция
```

#### Ключевые концепции клиента

1. **Модульная архитектура** - каждый функциональный блок изолирован
2. **Компонентный подход** - переиспользуемые UI компоненты
3. **Управление состоянием** - централизованное состояние через Zustand
4. **Типизация** - полная TypeScript типизация для надежности
5. **Responsive дизайн** - адаптивный интерфейс для различных устройств

### Серверная архитектура

#### Микросервисы

```
servers/crates/
├── api/                    # Основной API сервер
│   ├── main.rs            # Точка входа и роутинг
│   ├── auth.rs            # Аутентификация
│   └── events.rs          # Обработка событий
├── common/                 # Общие типы и утилиты
│   └── lib.rs             # Доменные модели
├── events/                 # WebSocket сервер
│   └── main.rs            # Real-time события
└── files/                  # Управление файлами
    └── main.rs            # File storage API
```

#### Ключевые концепции сервера

1. **Domain-Driven Design** - четкое разделение доменных моделей
2. **REST API** - стандартизированные HTTP endpoints
3. **WebSocket** - real-time коммуникация
4. **Middleware** - промежуточная обработка запросов
5. **Error Handling** - централизованная обработка ошибок

## 🔐 Система аутентификации

### Концепция безопасности

RSCORD использует **JWT (JSON Web Tokens)** для безопасной аутентификации пользователей с дополнительными мерами безопасности:

- **Argon2** для хеширования паролей
- **Временные токены** с автоматическим обновлением
- **Middleware аутентификации** для защиты endpoints
- **Валидация данных** на клиенте и сервере

### Flow аутентификации

```
1. Регистрация/Вход → 2. Валидация → 3. JWT генерация → 4. Сохранение токена
                                                                    ↓
5. Автоматическое использование токена для API запросов
                                                                    ↓
6. Middleware проверяет токен на защищенных endpoints
                                                                    ↓
7. Автоматическое обновление токена при истечении
```

### Компоненты аутентификации

#### Frontend (Auth Store)
```typescript
// Zustand store для управления аутентификацией
export const useAuth = create<AuthState>()(
  persist(
    (set, get) => ({
      token: null,
      user: null,
      isAuthenticated: false,
      // ... методы управления
    }),
    { name: 'auth-storage' }
  )
);
```

#### Backend (Auth Middleware)
```rust
// Middleware для проверки JWT токенов
async fn auth_middleware(
    State(state): State<AppState>, 
    mut req: Request<axum::body::Body>, 
    next: axum::middleware::Next
) -> Result<axum::response::Response, axum::http::StatusCode>
```

## 💬 Система коммуникации

### Real-time архитектура

RSCORD использует **WebSocket** для обеспечения real-time коммуникации между пользователями:

#### Типы событий
- **Сообщения** - отправка и получение сообщений в реальном времени
- **Индикаторы печати** - показ когда пользователь печатает
- **Обновления каналов** - изменения в структуре каналов
- **Обновления серверов** - изменения в настройках серверов
- **Статусы пользователей** - online/offline/idle/do not disturb

#### WebSocket клиент
```typescript
export class WebSocketClient {
  private ws: WebSocket | null = null;
  private listeners: Map<string, Set<(data: any) => void>> = new Map();
  
  // Автоматическое переподключение
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;
  
  // Event-driven архитектура
  on(event: string, callback: (data: any) => void)
  emit(event: string, data: any)
}
```

### Система сообщений

#### Структура сообщения
```typescript
interface Message {
  id: string;
  channel_id: string;
  author_id: string;
  content: string;
  attachments?: Attachment[];
  reactions?: Reaction[];
  created_at: string;
  updated_at?: string;
}
```

#### Функциональность чата
- **Отправка сообщений** в реальном времени
- **Редактирование** собственных сообщений
- **Удаление** сообщений (с правами)
- **Реакции** на сообщения
- **Вложения** файлов и медиа
- **Поиск** по истории сообщений

## 🏰 Система серверов и каналов

### Концепция серверов

**Сервер** в RSCORD - это изолированное сообщество пользователей с собственной структурой каналов, ролей и настроек.

#### Структура сервера
```rust
pub struct Guild {
    pub id: Id,
    pub name: String,
    pub owner_id: Id,
    pub created_at: DateTime<Utc>,
}
```

#### Функциональность серверов
- **Создание** новых серверов
- **Управление** участниками и ролями
- **Настройка** параметров и внешнего вида
- **Модерация** контента и участников

### Система каналов

#### Типы каналов
- **Текстовые каналы** - для обмена сообщениями
- **Голосовые каналы** - для аудио коммуникации
- **Категории** - для группировки каналов

#### Структура канала
```rust
pub struct Channel {
    pub id: Id,
    pub guild_id: Id,
    pub name: String,
    pub channel_type: String, // "text" или "voice"
    pub created_at: DateTime<Utc>,
}
```

## 👥 Система ролей и разрешений

### Концепция ролей

**Роли** в RSCORD - это наборы разрешений, которые определяют что может делать пользователь на сервере.

#### Параметры ролей
- **Название** - уникальное имя роли
- **Цвет** - визуальное представление роли
- **Разрешения** - детальные права доступа
- **Упоминаемость** - возможность упоминать роль (@role)
- **Отображение** - отдельное отображение в списке участников
- **Позиция** - иерархический порядок ролей

#### Категории разрешений
```typescript
const PERMISSIONS = {
  // Общие права
  'view_channels': 'Просмотр каналов',
  'send_messages': 'Отправка сообщений',
  
  // Модерация
  'manage_messages': 'Управление сообщениями',
  'manage_channels': 'Управление каналами',
  'manage_roles': 'Управление ролями',
  
  // Управление участниками
  'ban_members': 'Бан участников',
  'kick_members': 'Кик участников',
  
  // Голосовые каналы
  'connect': 'Подключение к голосовым каналам',
  'speak': 'Разговор в голосовых каналах',
  
  // Специальные
  'administrator': 'Администратор'
};
```

### Управление участниками

#### Функциональность
- **Просмотр** списка всех участников
- **Поиск** участников по имени или email
- **Назначение ролей** участникам
- **Удаление ролей** у участников
- **Модерация** участников (кик, бан)

## 🎤 Голосовая связь

### WebRTC интеграция

RSCORD использует **WebRTC** для обеспечения высококачественной голосовой связи между пользователями.

#### Компоненты голосовой системы
- **Signaling сервер** - координация соединений
- **WebRTC клиент** - установка peer-to-peer соединений
- **Аудио обработка** - кодеки и качество звука
- **Управление каналами** - вход/выход из голосовых каналов

#### Функциональность
- **Голосовые каналы** - создание и управление
- **Качество звука** - настройка битрейта и кодека
- **Push-to-talk** - активация микрофона по кнопке
- **Voice Activity Detection** - автоматическое определение речи
- **Стриминг** - трансляция экрана или приложения

## 📁 Система файлов

### MinIO интеграция

RSCORD использует **MinIO** (S3-совместимое хранилище) для управления файлами и медиа контентом.

#### Типы файлов
- **Изображения** - аватары, эмодзи, вложения
- **Документы** - PDF, Word, Excel файлы
- **Аудио/Видео** - голосовые сообщения, записи
- **Архивы** - сжатые файлы и папки

#### Функциональность
- **Загрузка файлов** с drag & drop
- **Предпросмотр** изображений и документов
- **Сжатие** изображений для оптимизации
- **Безопасность** - проверка типов файлов
- **Квоты** - ограничения на размер файлов

## 🔍 Система поиска

### Поиск по контенту

RSCORD предоставляет мощную систему поиска по различным типам контента:

#### Области поиска
- **Сообщения** - поиск по тексту сообщений
- **Пользователи** - поиск по имени или email
- **Каналы** - поиск по названию канала
- **Файлы** - поиск по названию файла
- **Роли** - поиск по названию роли

#### Функциональность поиска
- **Полнотекстовый поиск** с индексацией
- **Фильтры** по типу контента и дате
- **История поиска** для быстрого доступа
- **Поисковые подсказки** в реальном времени

## 🔔 Система уведомлений

### Типы уведомлений

RSCORD поддерживает различные типы уведомлений для информирования пользователей:

#### Категории уведомлений
- **Сообщения** - новые сообщения в каналах
- **Упоминания** - @username или @role упоминания
- **События сервера** - изменения в настройках
- **Системные** - обновления и технические уведомления

#### Настройки уведомлений
- **Глобальные настройки** - общие параметры
- **Настройки сервера** - специфичные для сервера
- **Настройки канала** - специфичные для канала
- **Временные блокировки** - Do Not Disturb режим

## ⚙️ Конфигурация и развертывание

### Docker Compose

RSCORD использует **Docker Compose** для простого развертывания всех сервисов:

```yaml
services:
  mongo:          # База данных MongoDB
  redis:          # Кеш и сессии
  rabbitmq:       # Message broker
  minio:          # S3-совместимое хранилище
  maildev:        # Тестовый почтовый сервер
```

### Переменные окружения

#### Основные настройки
```bash
RSCORD__BIND_ADDR=127.0.0.1:14702
RSCORD__MONGODB_URI=mongodb://localhost:27017
RSCORD__JWT_SECRET=your_secret_key
RSCORD__REDIS_URI=redis://127.0.0.1:6379/
```

#### Файл конфигурации
```toml
# rscord.toml
bind_addr = "127.0.0.1:14702"
mongodb_uri = "mongodb://localhost:27017"
jwt_secret = "your_secret_key"
```

## 🚀 Запуск и разработка

### Предварительные требования

- **Rust** (latest stable)
- **Node.js** 18+
- **MongoDB** 7.0+
- **Docker** и Docker Compose
- **Windows**: Visual Studio Build Tools

### Быстрый запуск

#### 1. Запуск инфраструктуры
```bash
docker-compose up -d
```

#### 2. Запуск API сервера
```bash
cd servers
cargo run -p rscord-api
```

#### 3. Запуск клиента
```bash
cd apps/desktop
npm install
npm run dev
```

#### 4. Запуск Tauri приложения
```bash
npm run tauri dev
```

### Скрипты автоматизации

RSCORD предоставляет готовые скрипты для Windows:

- **start_project.cmd** - полный запуск проекта
- **start_mongodb.cmd** - запуск MongoDB
- **run_tauri_with_msvc.cmd** - запуск Tauri с MSVC

## 🧪 Тестирование

### API тестирование

RSCORD включает готовые HTTP запросы для тестирования API:

```http
# test_auth.http
POST http://127.0.0.1:14702/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123",
  "display_name": "Test User"
}
```

### Типы тестов

- **Unit тесты** - тестирование отдельных функций
- **Integration тесты** - тестирование взаимодействия компонентов
- **API тесты** - тестирование HTTP endpoints
- **E2E тесты** - тестирование пользовательских сценариев

## 🔧 Разработка и расширение

### Добавление новых модулей

#### 1. Создание модуля
```bash
mkdir apps/desktop/src/modules/new_module
```

#### 2. Структура модуля
```
new_module/
├── components/     # React компоненты
├── pages/         # Страницы модуля
├── api.ts         # API функции
├── store.ts       # Zustand store
└── types.ts       # TypeScript типы
```

#### 3. Интеграция в роутинг
```typescript
// Добавление маршрута
{ path: "/new-module", element: <NewModulePage /> }
```

### Добавление новых API endpoints

#### 1. Создание обработчика
```rust
async fn new_endpoint(State(state): State<AppState>) -> Json<Response> {
    // Логика обработки
}
```

#### 2. Регистрация маршрута
```rust
.route("/new-endpoint", get(new_endpoint))
```

#### 3. Middleware аутентификации
```rust
// Автоматически применяется ко всем новым маршрутам
.layer(from_fn(auth_middleware))
```

## 📊 Производительность и масштабирование

### Оптимизации

#### Frontend
- **Code splitting** - разделение кода на чанки
- **Lazy loading** - загрузка компонентов по требованию
- **Memoization** - кеширование вычислений
- **Virtual scrolling** - для больших списков

#### Backend
- **Connection pooling** - пул соединений с базой данных
- **Caching** - Redis для кеширования
- **Async processing** - асинхронная обработка задач
- **Rate limiting** - защита от перегрузки

### Мониторинг

#### Метрики
- **Response time** - время ответа API
- **Throughput** - пропускная способность
- **Error rate** - частота ошибок
- **Resource usage** - использование ресурсов

#### Логирование
- **Structured logging** - структурированные логи
- **Log levels** - различные уровни детализации
- **Centralized logging** - централизованный сбор логов

## 🔒 Безопасность

### Меры безопасности

#### Аутентификация
- **JWT токены** с временем жизни
- **Refresh токены** для автоматического обновления
- **Secure cookies** для хранения токенов

#### Авторизация
- **Role-based access control** (RBAC)
- **Permission-based access** - детальные разрешения
- **Resource isolation** - изоляция ресурсов между серверами

#### Защита данных
- **HTTPS** для всех соединений
- **Password hashing** с Argon2
- **Input validation** - валидация входных данных
- **SQL injection protection** - защита от инъекций

#### Сетевая безопасность
- **CORS** настройки
- **Rate limiting** - ограничение частоты запросов
- **Request validation** - проверка структуры запросов

## 🚀 Планы развития

### Краткосрочные цели (1-3 месяца)

1. **Улучшение UI/UX**
   - Темная/светлая тема
   - Кастомизация интерфейса
   - Мобильная адаптация

2. **Расширение функционала**
   - Эмодзи реакции
   - Вложения файлов
   - Поиск по сообщениям

3. **Стабилизация**
   - Исправление багов
   - Улучшение производительности
   - Расширение тестового покрытия

### Среднесрочные цели (3-6 месяцев)

1. **Голосовая связь**
   - WebRTC интеграция
   - Голосовые каналы
   - Качество звука

2. **Модерация**
   - Система предупреждений
   - Автоматическая модерация
   - Логирование действий

3. **Интеграции**
   - Webhook поддержка
   - API для ботов
   - OAuth провайдеры

### Долгосрочные цели (6+ месяцев)

1. **Масштабирование**
   - Кластеризация серверов
   - Балансировка нагрузки
   - Географическое распределение

2. **Расширенные функции**
   - Видео звонки
   - Стриминг экрана
   - Совместная работа

3. **Экосистема**
   - Плагины и расширения
   - Marketplace приложений
   - Developer API

## 📚 Заключение

RSCORD представляет собой современную, масштабируемую платформу для коммуникации, построенную с использованием лучших практик разработки. Проект демонстрирует:

- **Архитектурную гибкость** - модульная структура и микросервисы
- **Технологическую современность** - Rust, React 19, TypeScript
- **Безопасность** - JWT, Argon2, RBAC
- **Производительность** - WebSocket, WebRTC, оптимизации
- **Масштабируемость** - Docker, MongoDB, Redis

Проект готов к дальнейшему развитию и может служить основой для создания полнофункциональной платформы коммуникации, конкурирующей с существующими решениями.

---

*Документация создана на основе анализа исходного кода проекта RSCORD. Для получения дополнительной информации обращайтесь к исходному коду и комментариям разработчиков.*
