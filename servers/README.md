# RSCORD Backend Services

Backend –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è RSCORD desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MongoDB
sudo apt update
sudo apt install mongodb

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis
sudo apt install redis-server

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å curl –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
sudo apt install curl
```

### 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x *.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
./start-backend.sh
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./check-status.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/gateway.log
tail -f logs/auth-service.log
tail -f logs/chat-service.log
```

### 4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
./stop-backend.sh
```

## üåê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤:
- **API Gateway**: 14700 (–æ—Å–Ω–æ–≤–Ω–æ–π endpoint)
- **Auth Service**: 14701
- **Chat Service**: 14703
- **Voice Service**: 14705
- **Presence Service**: 14706

### –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø:
- **URL**: `http://5.35.83.143:14700`
- **Desktop app**: –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `http://5.35.83.143:14700`

## üì° API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login` - –í—Ö–æ–¥
- `GET /api/auth/me` - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/auth/verify` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω
- `POST /api/auth/refresh` - –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
- `POST /api/auth/logout` - –í—ã—Ö–æ–¥

### –°–µ—Ä–≤–µ—Ä—ã:
- `GET /api/servers` - –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/servers` - –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä
- `GET /api/servers/:id` - –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
- `GET /api/servers/:id/channels` - –ö–∞–Ω–∞–ª—ã —Å–µ—Ä–≤–µ—Ä–∞
- `GET /api/servers/:id/members` - –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –ö–∞–Ω–∞–ª—ã:
- `GET /api/channels/:id/messages` - –°–æ–æ–±—â–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞
- `POST /api/channels/:id/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- `GET /api/users/profile` - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/users/update` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `POST /api/users/avatar` - –û–±–Ω–æ–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
- `POST /api/users/status` - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
- `POST /api/users/settings` - –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –§–∞–π–ª—ã:
- `POST /api/files/upload` - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
- `GET /api/files/:id` - –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª
- `DELETE /api/files/:id` - –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª

### –ì–æ–ª–æ—Å:
- `POST /api/voice/channels/:id/join` - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É
- `POST /api/voice/channels/:id/leave` - –ü–æ–∫–∏–Ω—É—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π –∫–∞–Ω–∞–ª
- `POST /api/voice/mute` - –ó–∞–≥–ª—É—à–∏—Ç—å/—Ä–∞–∑–≥–ª—É—à–∏—Ç—å
- `POST /api/voice/deafen` - –ó–∞–≥–ª—É—à–∏—Ç—å/—Ä–∞–∑–≥–ª—É—à–∏—Ç—å –∑–≤—É–∫

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:

```bash
cd auth-service
cargo run --release

cd ../chat-service
cargo run --release

cd ../voice-service
cargo run --release

cd ../gateway
cargo run --release
```

### –õ–æ–≥–∏:
- –í—Å–µ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `logs/`
- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç —Å–≤–æ–π –ª–æ–≥ —Ñ–∞–π–ª
- PID —Ñ–∞–π–ª—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ MongoDB –∏ Redis –∑–∞–ø—É—â–µ–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Ä—Ç –Ω–µ –∑–∞–Ω—è—Ç: `netstat -tlnp | grep :14700`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `tail -f logs/[service-name].log`

### Desktop app –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ gateway –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 14700
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall: `sudo ufw status`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø: `curl http://5.35.83.143:14700/health`

### –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω: `sudo systemctl status mongodb`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `mongo --eval "db.runCommand('ping')"`

## üìã –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:
```bash
# –ü–∞–º—è—Ç—å
free -h

# –î–∏—Å–∫
df -h

# –ü—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep -E "(gateway|auth|chat|voice|presence)"
```

### –°–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
```bash
# –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
netstat -tlnp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
nmap localhost -p 14700-14706
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –í—Å–µ API endpoints –∑–∞—â–∏—â–µ–Ω—ã (–∫—Ä–æ–º–µ /health)
- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é Argon2

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å: `./check-status.sh`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã: `./stop-backend.sh && ./start-backend.sh`
